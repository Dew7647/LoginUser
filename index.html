<!doctype html>
<html lang="th" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Sarabun', sans-serif; }
    .hidden { display: none; }
    .nav-active { color: #8b5cf6; border-top: 3px solid #8b5cf6; }
  </style>
</head>
<body class="h-full bg-gray-50">

  <div id="login-screen" class="flex min-h-full items-center justify-center p-4 bg-gradient-to-tr from-indigo-500 to-purple-600">
    <div class="bg-white p-8 rounded-3xl shadow-xl w-full max-w-sm text-center">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
      <form id="login-form" class="space-y-4 text-left">
        <input type="text" id="sid" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤" required class="w-full p-4 border rounded-2xl outline-none focus:ring-2 focus:ring-purple-400">
        <input type="password" id="bday" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required class="w-full p-4 border rounded-2xl outline-none focus:ring-2 focus:ring-purple-400">
        <button type="submit" id="login-btn" class="w-full py-4 bg-purple-600 text-white rounded-2xl font-bold shadow-lg hover:bg-purple-700 transition">Login</button>
        <button type="button" onclick="showRegister()" class="w-full text-sm text-gray-500 mt-2 underline">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</button>
      </form>
    </div>
  </div>

  <div id="register-screen" class="hidden flex min-h-full items-center justify-center p-4 bg-gradient-to-tr from-emerald-500 to-teal-600">
    <div class="bg-white p-8 rounded-3xl shadow-xl w-full max-w-sm text-center">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h2>
      <form id="register-form" class="space-y-4 text-left">
        <input type="text" id="reg-sid" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤" required class="w-full p-4 border rounded-2xl outline-none focus:ring-2 focus:ring-teal-400">
        <input type="text" id="reg-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required class="w-full p-4 border rounded-2xl outline-none focus:ring-2 focus:ring-teal-400">
        <input type="password" id="reg-pass" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏ß‡∏ß‡∏î‡∏î‡∏õ‡∏õ‡∏õ‡∏õ)" required class="w-full p-4 border rounded-2xl outline-none focus:ring-2 focus:ring-teal-400">
        <button type="submit" id="reg-btn" class="w-full py-4 bg-teal-600 text-white rounded-2xl font-bold shadow-lg">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
        <button type="button" onclick="showLogin()" class="w-full text-sm text-gray-500 mt-2 underline text-center block">‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß? ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Login</button>
      </form>
    </div>
  </div>

  <div id="app-screen" class="hidden flex flex-col h-full overflow-hidden">
    <header class="bg-white p-6 shadow-md flex justify-between items-center">
      <div>
        <h1 id="user-name" class="font-bold text-gray-800 text-lg">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</h1>
        <p id="user-id-display" class="text-xs text-gray-400"></p>
      </div>
      <button onclick="location.reload()" class="bg-red-50 text-red-600 p-2 rounded-xl text-xs font-bold">‡∏≠‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </header>

    <main class="flex-1 overflow-y-auto p-6 space-y-6">
      <section id="menu-checkin" class="space-y-4">
        <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100">
          <h3 class="font-bold text-gray-700 mb-4">üìç ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h3>
          <select id="location" class="w-full p-4 bg-gray-50 border rounded-2xl mb-4 appearance-none outline-none">
            <option value="1">‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 1 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏ß‡∏°</option>
            <option value="2">‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 2 ‡πÇ‡∏£‡∏á‡∏¢‡∏¥‡∏°</option>
          </select>
          <div class="flex gap-4 mb-6">
            <label class="flex-1 text-center py-4 border rounded-2xl cursor-pointer has-[:checked]:bg-purple-100 has-[:checked]:border-purple-500">
              <input type="radio" name="ctype" value="‡πÄ‡∏Ç‡πâ‡∏≤" checked class="hidden">‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏Ç‡πâ‡∏≤
            </label>
            <label class="flex-1 text-center py-4 border rounded-2xl cursor-pointer has-[:checked]:bg-purple-100 has-[:checked]:border-purple-500">
              <input type="radio" name="ctype" value="‡∏≠‡∏≠‡∏Å" class="hidden">‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏≠‡∏Å
            </label>
          </div>
          <button id="btn-save" class="w-full py-5 bg-purple-600 text-white rounded-2xl font-bold text-lg shadow-xl active:scale-95 transition">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î</button>
        </div>
      </section>

      <section id="menu-stats" class="hidden">
        <div class="bg-purple-600 p-10 rounded-[40px] text-white text-center shadow-2xl relative overflow-hidden">
          <div class="relative z-10">
            <p class="text-purple-100 font-medium">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏™‡∏∞‡∏™‡∏°</p>
            <h2 id="display-hours" class="text-7xl font-black my-4">0</h2>
            <div class="bg-white/20 inline-block px-4 py-1 rounded-full text-xs">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</div>
          </div>
        </div>
      </section>
    </main>

    <nav class="bg-white border-t flex justify-around py-4 pb-10">
      <button onclick="tab('checkin')" id="nav-checkin" class="flex-1 nav-active flex flex-col items-center">
        <span class="text-2xl">üìç</span><span class="text-[10px] font-bold">‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</span>
      </button>
      <button onclick="tab('stats')" id="nav-stats" class="flex-1 text-gray-400 flex flex-col items-center">
        <span class="text-2xl">üìä</span><span class="text-[10px] font-bold">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</span>
      </button>
    </nav>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyDqA7xiEJvKOqwHffluWLLIntXzim88y3TMBdPCotcbOM0KRM8fuNFrDcDCHiUHZEe/exec";
    let currentUser = null;

    function showRegister() { document.getElementById('login-screen').classList.add('hidden'); document.getElementById('register-screen').classList.remove('hidden'); }
    function showLogin() { document.getElementById('register-screen').classList.add('hidden'); document.getElementById('login-screen').classList.remove('hidden'); }

    // ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
    document.getElementById('register-form').onsubmit = async (e) => {
      e.preventDefault();
      const btn = document.getElementById('reg-btn'); btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å..."; btn.disabled = true;
      const res = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({
        action: "register",
        student_id: document.getElementById('reg-sid').value,
        student_name: document.getElementById('reg-name').value,
        password: document.getElementById('reg-pass').value
      })});
      const result = await res.json();
      alert(result.success ? "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!" : result.message);
      if(result.success) showLogin();
      btn.innerText = "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô"; btn.disabled = false;
    };

    // ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
    document.getElementById('login-form').onsubmit = async (e) => {
      e.preventDefault();
      const btn = document.getElementById('login-btn'); btn.innerText = "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•..."; btn.disabled = true;
      const res = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({
        action: "login",
        student_id: document.getElementById('sid').value,
        password: document.getElementById('bday').value
      })});
      const result = await res.json();
      if(result.success) {
        currentUser = { id: document.getElementById('sid').value, name: result.name };
        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('app-screen').classList.remove('hidden');
        document.getElementById('user-name').innerText = result.name;
        document.getElementById('user-id-display').innerText = "ID: " + currentUser.id;
        document.getElementById('display-hours').innerText = result.hours;
      } else { alert(result.message); }
      btn.innerText = "Login"; btn.disabled = false;
    };

    function tab(name) {
      document.getElementById('menu-checkin').classList.toggle('hidden', name !== 'checkin');
      document.getElementById('menu-stats').classList.toggle('hidden', name !== 'stats');
      document.getElementById('nav-checkin').classList.toggle('nav-active', name === 'checkin');
      document.getElementById('nav-stats').classList.toggle('nav-active', name === 'stats');
    }

    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô
    document.getElementById('btn-save').onclick = async () => {
      const btn = document.getElementById('btn-save'); btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î..."; btn.disabled = true;
      navigator.geolocation.getCurrentPosition(async (pos) => {
        await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({
          action: "checkin",
          student_id: currentUser.id,
          student_name: currentUser.name,
          check_type: document.querySelector('input[name="ctype"]:checked').value,
          latitude: pos.coords.latitude, longitude: pos.coords.longitude
        })});
        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!"); btn.innerText = "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°"; btn.disabled = false;
      }, () => { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î GPS"); btn.disabled = false; btn.innerText = "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°"; });
    };
  </script>
</body>
</html>
